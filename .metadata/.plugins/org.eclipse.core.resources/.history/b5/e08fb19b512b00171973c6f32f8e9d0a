package com.ads.autodata;

import java.io.IOException;
import java.util.ArrayList;

import com.object.*;
import org.jsoup.Jsoup;
import org.jsoup.nodes.*;
import org.jsoup.select.Elements;

public class GetDataImpl implements GetData {

	@Override
	public ProductObject getData(String url) {
		ProductObject item = new ProductObject();
		Document doc = null;
		try {
			doc = Jsoup.connect(url).get();
			if(url.contains("trananh.vn")){
				Elements e = doc.getElementsByClass(DataConstant.PRPRIMARYTA);
				item.setProduct_name(e.select(DataConstant.PRNAMETA).text());
				item.setProduct_summary(e.select(DataConstant.PRSUMMARYTA).text());
				if(e.select(DataConstant.PRSTATUSTA).text().equalsIgnoreCase("Còn hàng")){
					item.setProduct_status(true);
				}else{
					item.setProduct_status(false);
				}
				if(e.select(DataConstant.PRWARRANTYTA).isEmpty()){
					item.setProduct_warranty_time(0);
				}else{
				item.setProduct_warranty_time(Integer.parseInt(e.select(DataConstant.PRWARRANTYTA).text().trim().substring(e.select(DataConstant.PRWARRANTYTA).text().indexOf(": ")+2, (e.select(DataConstant.PRWARRANTYTA).text().indexOf(": ") + 4))));
				}
				if(e.select(DataConstant.PRPRICETA).isEmpty()){
					item.setProduct_origin_price(0);
				}else{
					
				String stroriginPrice = getPrice(e.select(DataConstant.PRPRICETA).text());
				item.setProduct_origin_price(Integer.parseInt(stroriginPrice.substring(0, stroriginPrice.length()-1)));
				}
				if(e.select(DataConstant.PRSAFEOFFTA).isEmpty()){
					item.setProduct_promotion(null);
				}else{
					item.setProduct_promotion(e.select(DataConstant.PRSAFEOFFTA).text());
				}
				if(e.select(DataConstant.PRDECTA).isEmpty()){
					item.setProduct_specification(null);
				}else{
					item.setProduct_specification(e.select(DataConstant.PRDECTA).html());
				}
			}else if(url.contains("hanoicomputer.vn")){
				Element e = doc.getElementById(DataConstant.PRPRIMARYHN);
				item.setProduct_name(e.select(DataConstant.PRNAMEHN).text());
				item.setProduct_summary(e.select(DataConstant.PRSUMMARYHN).text());
				if(e.select(DataConstant.PRPRICEHN).isEmpty()){
					item.setProduct_origin_price(0);
				}else{
					String stroriginPrice = getPrice(e.select(DataConstant.PRPRICEHN).text());
					item.setProduct_origin_price(Integer.parseInt(stroriginPrice.substring(0, stroriginPrice.length()-2)));
				}
				if(e.select(DataConstant.PRSAFEOFFHN).isEmpty()){
					item.setProduct_promotion(null);
				}else{
					item.setProduct_promotion(e.select(DataConstant.PRSAFEOFFHN).text());
				}
				if(e.select(DataConstant.PRDECHN).isEmpty()){
					item.setProduct_specification(null);
				}else{
					item.setProduct_specification(e.select(DataConstant.PRDECHN).html());
				}
			}
			else{
			item = null;
			}
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return item;
	}

	@Override
	public ArrayList<WebObject> getDatas(String url) {
		// TODO Auto-generated method stub
		return null;
	}
	public static String getPrice(String stroriginPrice){
		for(int i = 0;i < stroriginPrice.length();i++){
			if(stroriginPrice.charAt(i) == '.'){
				stroriginPrice = removeCharAt(stroriginPrice,i);
			}
		}
		return stroriginPrice;
	}
	public static String removeCharAt(String s, int pos) {
	      return s.substring(0, pos) + s.substring(pos + 1);
	}
	public static String getProductForKeywordHN(String key){
		String tmp = "";
		ProductObject item = new ProductObject();
		Document doc = null;
		try {
			
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return tmp;
	}
	public static void main(String[] args){
		GetData gd = new GetDataImpl();
		ProductObject productObject = gd.getData("https://www.hanoicomputer.vn/laptop-asus-x541uv-xx037d-mong-nhe-moi-nhat-mau-den/p35725.html");
		if(productObject != null){
		System.out.println(productObject.getProduct_name());
		System.out.println(productObject.getProduct_origin_price());
		System.out.println(productObject.getProduct_summary());
		System.out.println(productObject.getProduct_warranty_time());
		System.out.println(productObject.isProduct_status());
		System.out.println(productObject.getProduct_promotion());
		System.out.println(productObject.getProduct_specification());
		}
		else{
			System.out.println("Trang web chưa được thêm vào! Liên hệ với quản trị để được bổ sung.");
		}
	}
}
